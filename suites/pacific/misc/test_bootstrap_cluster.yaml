name: Configuration suite file for cluster bootstrap with mandatory components.
must_pass: true
tests:
  - runs_on: ceph-cluster1
    parallel: false
    config:
      - test:
          name: cluster bootstrap
          desc: Configuration for bootstrap using cephadm
          module: workflow.py
          steps:
            - method: bootstrap
              class: cephadm
              component: cephadm
              args:
                registry-url: registry.redhat.io
                orphan-initial-daemons: true
                allow-fqdn-hostname: true
                yes-i-know: true
              role: _admin
            - method: copy_admin_sshkeys
              module: utils.py
              role: _admin
            - method: transfer_remote_files
              module: utils.py
              args:
                source_role: _admin
                source_path: /etc/ceph/ceph.client.admin.keyring
                destination_path: /etc/ceph/ceph.client.admin.keyring
                destination_role: client
              role: _admin
            - method: transfer_remote_files
              module: utils.py
              args:
                source_role: _admin
                source_path: /etc/ceph/ceph.conf
                destination_path: /etc/ceph/ceph.conf
                destination_role: client
              role: _admin
            - method: add
              class: Host
              component: ceph
              args:
                host_name: all
              role: _admin
            - method: add
              class: Label
              component: ceph
              args:
                host_name:
                  role: mgr
                label: mgr
              role: _admin
            - method: add
              class: Label
              component: ceph
              args:
                host_name:
                  role: mon
                label: mon
              role: _admin
            - method: apply
              class: Orch
              component: ceph
              args:
                service_name: mgr
                placement:
                  label: mgr
              role: _admin
            - method: apply
              class: Orch
              component: ceph
              args:
                service_name: mon
                placement:
                  label: mon
              role: _admin
            - method: apply
              class: Orch
              component: ceph
              args:
                service_name: osd
                all-available-devices: true
              role: _admin
            - method: shell
              class: cephadm
              component: cephadm
              args:
                cmd: ceph fs volume create cephfs
              role: installer
      # - test:
      #     name: Configuration of client node in cluster.
      #     desc: configuration of client node.
      #     suite: misc/test_configure_client.yaml
